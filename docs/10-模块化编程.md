# ç¬¬ 10 è¯¾ï¼šæ¨¡å—åŒ–ç¼–ç¨‹ ğŸ“¦

å°†å¤§å‹é¡¹ç›®æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½ã€‚

---

## 10.1 ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–ï¼Ÿ

æƒ³è±¡ä½ è¦å†™ä¸€ä¸ª 10000 è¡Œçš„ç¨‹åºï¼Œå…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼š

```c
// âŒ æ‰€æœ‰ä»£ç åœ¨ä¸€ä¸ªæ–‡ä»¶
// main.c - 10000 è¡Œ
// æ‰¾åˆ° bug è¯•è¯•ï¼Ÿ
```

**æ¨¡å—åŒ–çš„å¥½å¤„ï¼š**
- ğŸ“ **æ˜“äºç®¡ç†** - æ¯ä¸ªæ–‡ä»¶è´Ÿè´£ç‰¹å®šåŠŸèƒ½
- ğŸ” **æ˜“äºè°ƒè¯•** - é—®é¢˜å®šä½æ›´å¿«
- ğŸ¤ **å›¢é˜Ÿåä½œ** - ä¸åŒäººå†™ä¸åŒæ¨¡å—
- ğŸ”„ **ä»£ç å¤ç”¨** - æ¨¡å—å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨

---

## 10.2 å¤´æ–‡ä»¶çš„ä½œç”¨

### å£°æ˜ vs å®ç°

```c
// snake.h - å£°æ˜ï¼ˆæ¥å£ï¼‰
#ifndef SNAKE_H
#define SNAKE_H

typedef struct Snake Snake;
Snake* snake_create(int x, int y);
void snake_move(Snake* s);
void snake_destroy(Snake* s);

#endif

// snake.c - å®ç°ï¼ˆå…·ä½“ä»£ç ï¼‰
#include "snake.h"

Snake* snake_create(int x, int y) {
    // å®é™…å®ç°
}

void snake_move(Snake* s) {
    // å®é™…å®ç°
}
```

---

## 10.3 å¤´æ–‡ä»¶ä¿æŠ¤

é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤åŒ…å«ï¼š

```c
// âŒ æ²¡æœ‰ä¿æŠ¤
// å¦‚æœè¢«åŒ…å«ä¸¤æ¬¡ï¼Œä¼šé‡å¤å®šä¹‰

// âœ… æœ‰ä¿æŠ¤
#ifndef SNAKE_H
#define SNAKE_H

// å†…å®¹åªä¼šè¢«å¤„ç†ä¸€æ¬¡

#endif
```

---

## 10.4 æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ main.c              # ç¨‹åºå…¥å£
â”œâ”€â”€ game.c / game.h     # æ¸¸æˆæ ¸å¿ƒ
â”œâ”€â”€ snake.c / snake.h   # è›‡æ¨¡å—
â”œâ”€â”€ food.c / food.h     # é£Ÿç‰©æ¨¡å—
â”œâ”€â”€ ui.c / ui.h         # ç•Œé¢æ¨¡å—
â”œâ”€â”€ input.c / input.h   # è¾“å…¥æ¨¡å—
â”œâ”€â”€ score.c / score.h   # åˆ†æ•°æ¨¡å—
â””â”€â”€ utils.c / utils.h   # å·¥å…·å‡½æ•°
```

---

## 10.5 æ¨¡å—ä¾èµ–å…³ç³»

```
                    main.c
                      â”‚
                      â†“
                   game.c
                  â†™  â†“  â†˜
            snake.c  food.c  score.c
                â”‚       â”‚        â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                     utils.c
                        â”‚
                        â†“
                      ui.c
                        â”‚
                        â†“
                    input.c
```

---

## 10.6 åŒ…å«é¡ºåº

```c
// main.c
#include <stdio.h>      // æ ‡å‡†åº“
#include <stdlib.h>     // æ ‡å‡†åº“
#include "game.h"       // è‡ªå·±çš„å¤´æ–‡ä»¶
#include "snake.h"
#include "ui.h"
```

**è§„åˆ™ï¼š**
1. å…ˆåŒ…å«æ ‡å‡†åº“
2. å†åŒ…å«è‡ªå·±çš„å¤´æ–‡ä»¶
3. æŒ‰ä¾èµ–å…³ç³»æ’åº

---

## 10.7 ç¼–è¯‘å¤šä¸ªæ–‡ä»¶

### æ–¹æ³• 1ï¼šä¸€æ¬¡æ€§ç¼–è¯‘

```bash
gcc src/main.c src/snake.c src/food.c src/ui.c -o snake_game
```

### æ–¹æ³• 2ï¼šåˆ†æ­¥ç¼–è¯‘

```bash
# ç¼–è¯‘æ¯ä¸ª .c æ–‡ä»¶ä¸º .o æ–‡ä»¶
gcc -c src/main.c -o obj/main.o
gcc -c src/snake.c -o obj/snake.o
gcc -c src/food.c -o obj/food.o

# é“¾æ¥æ‰€æœ‰ .o æ–‡ä»¶
gcc obj/main.o obj/snake.o obj/food.o -o snake_game
```

---

## 10.8 å®æˆ˜ï¼šåˆ›å»ºæ¨¡å—

### utils.h
```c
#ifndef UTILS_H
#define UTILS_H

#include <stdbool.h>

// ç‚¹ç»“æ„
typedef struct {
    int x;
    int y;
} Point;

// å‡½æ•°å£°æ˜
Point point_create(int x, int y);
bool point_equals(Point a, Point b);
int random_range(int min, int max);

#endif
```

### utils.c
```c
#include "utils.h"
#include <stdlib.h>
#include <time.h>

static int seeded = 0;

Point point_create(int x, int y) {
    Point p = {x, y};
    return p;
}

bool point_equals(Point a, Point b) {
    return a.x == b.x && a.y == b.y;
}

int random_range(int min, int max) {
    if (!seeded) {
        srand(time(NULL));
        seeded = 1;
    }
    return min + rand() % (max - min + 1);
}
```

### snake.h
```c
#ifndef SNAKE_H
#define SNAKE_H

#include "utils.h"

typedef struct Segment {
    Point position;
    struct Segment* next;
} Segment;

typedef struct Snake {
    Segment* head;
    Segment* tail;
    int length;
    int direction;
} Snake;

Snake* snake_create(int x, int y);
void snake_move(Snake* s);
void snake_destroy(Snake* s);

#endif
```

### snake.c
```c
#include "snake.h"
#include <stdlib.h>

Snake* snake_create(int x, int y) {
    Snake* snake = malloc(sizeof(Snake));
    Segment* head = malloc(sizeof(Segment));
    
    head->position = point_create(x, y);
    head->next = NULL;
    
    snake->head = head;
    snake->tail = head;
    snake->length = 1;
    snake->direction = 0;
    
    return snake;
}

void snake_move(Snake* s) {
    // å®ç°...
}

void snake_destroy(Snake* s) {
    Segment* current = s->head;
    while (current) {
        Segment* next = current->next;
        free(current);
        current = next;
    }
    free(s);
}
```

### main.c
```c
#include <stdio.h>
#include "snake.h"
#include "utils.h"

int main(void) {
    Snake* snake = snake_create(10, 10);
    
    printf("è›‡åˆ›å»ºæˆåŠŸ!\n");
    printf("ä½ç½®ï¼š(%d, %d)\n", 
           snake->head->position.x,
           snake->head->position.y);
    
    snake_destroy(snake);
    return 0;
}
```

---

## 10.9 å¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šå¾ªç¯åŒ…å«
```c
// a.h
#include "b.h"  // âŒ b.h åˆåŒ…å« a.h

// b.h
#include "a.h"  // âŒ å¾ªç¯ä¾èµ–ï¼
```

**è§£å†³ï¼š** ä½¿ç”¨å‰å‘å£°æ˜
```c
// a.h
typedef struct B B;  // å‰å‘å£°æ˜ï¼Œä¸åŒ…å« b.h
```

### é”™è¯¯ 2ï¼šåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å˜é‡
```c
// âŒ utils.h
int counter = 0;  // æ¯ä¸ªåŒ…å«çš„æ–‡ä»¶éƒ½ä¼šå®šä¹‰ä¸€æ¬¡

// âœ… utils.h
extern int counter;  // å£°æ˜

// âœ… utils.c
int counter = 0;     // å®šä¹‰
```

---

## âœ… æœ¬è¯¾æ£€æŸ¥æ¸…å•

- [ ] ç†è§£æ¨¡å—åŒ–çš„å¥½å¤„
- [ ] çŸ¥é“å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶çš„åŒºåˆ«
- [ ] ä¼šä½¿ç”¨å¤´æ–‡ä»¶ä¿æŠ¤
- [ ] ç†è§£ç¼–è¯‘å’Œé“¾æ¥è¿‡ç¨‹
- [ ] èƒ½é¿å…å¸¸è§æ¨¡å—é”™è¯¯

---

## ğŸ“ ä½œä¸š

1. å°†ä½ çš„è´ªåƒè›‡ä»£ç æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—

2. ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºå¯¹åº”çš„ `.h` å’Œ `.c` æ–‡ä»¶

3. ä½¿ç”¨ `#ifndef` ä¿æŠ¤æ‰€æœ‰å¤´æ–‡ä»¶

---

ä¸‹ä¸€è¯¾ï¼š[Makefile](11-Makefile.md)
